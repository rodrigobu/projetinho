{% extends "home/base.html" %}
{% load i18n  %}
{% load static %}
{% load xenon_core %}

{% block custom_css %}
{% include "statics/css/formularios.html" %}
{% include 'statics/css/datatables.html' %}
{% endblock %}

{% block main %}

{% page_title title=title description=description_title %}
{% include 'messages/xenon_success_or_error_list.html' %}

<div class="panel panel-default">

	<div class="panel-body">
		<div class="row margin-bottom-10">
		</div>
    	<div id="datatable_conversa" class="dataTable"></div>
	</div>
</div>
{% endblock %}

{% block custom_js %}
{% include 'statics/js/datatables.html' %}
{% include "statics/js/formularios.html" %}

<script>
var URL_CONSULTA = '{% url "chatbot.listagem.conversa.json" %}';
var URL_EDICAO = "{% url 'chatbot.edicao.conversa' %}"
var ICON_DELETE = '{{ ICONES.delete }}';
var ICON_EDIT = '{{ ICONES.edit }}'
var TABELA_CONSULTA = undefined;
var TITULO_EDIT = 'Edição da conversa do bot';

function criar_conversa(){
  TABELA_CONSULTA = $.DataTableXenon({
  	json : URL_CONSULTA,
  	container: "datatable_conversa",
    filterForm: '#filtro_consulta',
    order: [[1, "asc"]],
    aoColumns: [
        {
           "mData": "Ações",
           'orderable': false,
           'searchable': false,
           'class':'col-md-1 text-center md_icons',
           "mRender": function ( data, type, full ) {
             let HTML = ''
             HTML += '<a href="'+ URL_EDICAO + full["bot_id"] + '" title="'+TITULO_EDIT+'" class="text-gray "><i class="'+ICON_EDIT+'"></i> </a>';
             // HTML += '<a href="#" title="'+TITULO_EXC+'" class="text-gray " onclick="excluir_registro(\''+full["slug"]+'\')"> <i class="'+ICON_DELETE+'"></i></a>';
             return HTML;
           }
       },
       {
          "mData": "Pergunta",
		  'orderable': true,
          'searchable': true,
          'class':'col-md-3',
          "mRender": function ( data, type, full ) {
            return full.pergunta;
          }
	   },
       {
          "mData": "Resposta",
		  'orderable': true,
          'searchable': true,
          'class':'col-md-4',
          "mRender": function ( data, type, full ) {
            return full.resposta;
          }
	   },
       {
          "mData": "Produto",
		  'orderable': true,
          'searchable': true,
          'class':'col-md-1',
          "mRender": function ( data, type, full ) {
            let produto = full.extra_data.split(',')[0]
            if (produto == '1') {
              return 'GCA';
            } else if (produto == '2') {
                return 'SPA';
            } else if (produto == '3') {
                return 'PCO';
            } else if (produto == '4') {
                return 'TODOS'
            } else {
                return 'Sem Produto';
            }
          }
	   },
       {
          "mData": "Permissão",
		  'orderable': true,
          'searchable': true,
          'class':'col-md-2',
          "mRender": function ( data, type, full ) {
            let permissao = full.extra_data.split(',')[1]
            if (permissao == '1') {
                return 'SUPORTE';
            } else if (permissao == '2') {
                return 'CONSULTORIA';
            } else if (permissao == '3') {
                return 'PUBLICO'
            }else {
                return '';

            }
          }
	   },

   ]
  });
}

function consultar(){
  TABELA_CONSULTA.reload();
}

$(function() {
    criar_conversa();
});

function excluir_registro(slug_registro){

  $.dialogs.confirm('', ALERTA_EXC, function() {
    $.ajax({
      url : URL_EXCLUSAO,
      type : 'get',
      dataType : 'json',
      async : false,
      data : { num : slug_registro },
      success : function(dados) {
        $.dialogs.success(ALERTA_SUC_EXC);
        consultar();
      }
    });
  });

}

</script>


{% endblock %}
